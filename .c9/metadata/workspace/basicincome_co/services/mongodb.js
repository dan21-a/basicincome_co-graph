{"filter":false,"title":"mongodb.js","tooltip":"/basicincome_co/services/mongodb.js","undoManager":{"mark":94,"position":94,"stack":[[{"group":"doc","deltas":[{"start":{"row":0,"column":0},"end":{"row":148,"column":0},"action":"insert","lines":["var module = angular.module('rp')","",""," module.factory('MongoDB', function ($mongolabResourceHttp) {","      ","    return $mongolabResourceHttp('I changed angular-mongolab.js, use Project.collection instead, see below');","});","","angular.module('rp').service('$MongoDB', ['$rootScope', 'MongoDB', '$connection_status', function ($scope, MongoDB, $connection_status) {","  ","  ","if(typeof $scope.userBlob.data.basicincome_co !== \"undefined\"){","$scope.connected = true","}","else $scope.connected = false","    ","    ","    /**","     * Add a currency","     */","    this.create = function ()","    {","      var basicincome_co = {","        currency: \"RES\",","        taxRate: 0.02","      };","     ","","      // Add an element","      $scope.userBlob.unshift(\"/basicincome_co\", basicincome_co);","","      MongoDB.collection($scope.userBlob.data.account_id)","      var passport = {type:\"passport\", network: \"BitNation\"}","      var contract = {type: \"contract\", currency: basicincome_co.currency, taxRate: basicincome_co.taxRate}","","      new MongoDB(passport).$save().then(function (data) {","            console.log(data);","      });","","      new MongoDB(contract).$save().then(function (data) {","            console.log(data);","      });","","","    $connection_status.connect()","      ","      ","    };","    ","","      /**","       * Remove currency","       *","       * @param index","       */","  this.remove = function (currency) {","        ","        // Update blob","        $scope.userBlob.unset('/basicincome_co');","        ","        ","        // remove from MongoDB","        MongoDB.collection($scope.userBlob.data.account_id)","                ","                //remove passport    ","            MongoDB.query({type: \"passport\"}).then(function(data){","                      ","            var temp = data","            var id","            id = temp[0]._id","            ","            MongoDB.remove_one(id)","  ","          })","                    ","            //remove contract        ","          MongoDB.query({type: \"contract\"}).then(function(data){","                      ","            var temp = data","            var id","            id = temp[0]._id","            ","            MongoDB.remove_one(id)","  ","          })","          ","          ","        ","        ","    $connection_status.disconnect()","        }","        ","","this.delete_everything = function (currency) {","        ","        // Update blob","        $scope.userBlob.unset('/basicincome_co');","        ","        ","        // remove from MongoDB","        MongoDB.collection($scope.userBlob.data.account_id)","                ","                //remove passport    ","            MongoDB.all({}).then(function(data){","            console.log(data)","            for(var i = 0; i<data.length;i++){","            ","            new MongoDB(data[i]).$remove().then(function (data) {","            console.log(data);","            });","            }","          })","","  new MongoDB().$delete_collection().then(function (data) {","            console.log(data);","            });","                    ","                    ","            //remove contract        ","          MongoDB.query({type: \"contract\"}).then(function(data){","                      ","            var temp = data","            var id","            id = temp[0]._id","            ","            MongoDB.remove_one(id)","  ","          })","          ","          ","        ","        ","    $connection_status.disconnect()","        }","        ","","","","}]);","",""," ","","","","","","",""]}]}],[{"group":"doc","deltas":[{"start":{"row":0,"column":29},"end":{"row":0,"column":31},"action":"remove","lines":["rp"]},{"start":{"row":0,"column":29},"end":{"row":0,"column":30},"action":"insert","lines":["a"]}]}],[{"group":"doc","deltas":[{"start":{"row":0,"column":30},"end":{"row":0,"column":31},"action":"insert","lines":["å"]}]}],[{"group":"doc","deltas":[{"start":{"row":0,"column":31},"end":{"row":0,"column":32},"action":"insert","lines":["p"]}]}],[{"group":"doc","deltas":[{"start":{"row":0,"column":31},"end":{"row":0,"column":32},"action":"remove","lines":["p"]}]}],[{"group":"doc","deltas":[{"start":{"row":0,"column":30},"end":{"row":0,"column":31},"action":"remove","lines":["å"]}]}],[{"group":"doc","deltas":[{"start":{"row":0,"column":30},"end":{"row":0,"column":31},"action":"insert","lines":["p"]}]}],[{"group":"doc","deltas":[{"start":{"row":0,"column":31},"end":{"row":0,"column":32},"action":"insert","lines":["p"]}]}],[{"group":"doc","deltas":[{"start":{"row":8,"column":68},"end":{"row":8,"column":86},"action":"remove","lines":["$connection_status"]}]}],[{"group":"doc","deltas":[{"start":{"row":8,"column":68},"end":{"row":8,"column":69},"action":"remove","lines":["'"]}]}],[{"group":"doc","deltas":[{"start":{"row":8,"column":67},"end":{"row":8,"column":68},"action":"remove","lines":["'"]}]}],[{"group":"doc","deltas":[{"start":{"row":8,"column":66},"end":{"row":8,"column":67},"action":"remove","lines":[" "]}]}],[{"group":"doc","deltas":[{"start":{"row":8,"column":65},"end":{"row":8,"column":66},"action":"remove","lines":[","]}]}],[{"group":"doc","deltas":[{"start":{"row":8,"column":94},"end":{"row":8,"column":112},"action":"remove","lines":["$connection_status"]}]}],[{"group":"doc","deltas":[{"start":{"row":8,"column":93},"end":{"row":8,"column":94},"action":"remove","lines":[" "]}]}],[{"group":"doc","deltas":[{"start":{"row":8,"column":92},"end":{"row":8,"column":93},"action":"remove","lines":[","]}]}],[{"group":"doc","deltas":[{"start":{"row":11,"column":0},"end":{"row":14,"column":29},"action":"remove","lines":["if(typeof $scope.userBlob.data.basicincome_co !== \"undefined\"){","$scope.connected = true","}","else $scope.connected = false"]}]}],[{"group":"doc","deltas":[{"start":{"row":11,"column":0},"end":{"row":12,"column":4},"action":"remove","lines":["","    "]}]}],[{"group":"doc","deltas":[{"start":{"row":10,"column":2},"end":{"row":11,"column":0},"action":"remove","lines":["",""]}]}],[{"group":"doc","deltas":[{"start":{"row":10,"column":2},"end":{"row":129,"column":8},"action":"remove","lines":["","    ","    /**","     * Add a currency","     */","    this.create = function ()","    {","      var basicincome_co = {","        currency: \"RES\",","        taxRate: 0.02","      };","     ","","      // Add an element","      $scope.userBlob.unshift(\"/basicincome_co\", basicincome_co);","","      MongoDB.collection($scope.userBlob.data.account_id)","      var passport = {type:\"passport\", network: \"BitNation\"}","      var contract = {type: \"contract\", currency: basicincome_co.currency, taxRate: basicincome_co.taxRate}","","      new MongoDB(passport).$save().then(function (data) {","            console.log(data);","      });","","      new MongoDB(contract).$save().then(function (data) {","            console.log(data);","      });","","","    $connection_status.connect()","      ","      ","    };","    ","","      /**","       * Remove currency","       *","       * @param index","       */","  this.remove = function (currency) {","        ","        // Update blob","        $scope.userBlob.unset('/basicincome_co');","        ","        ","        // remove from MongoDB","        MongoDB.collection($scope.userBlob.data.account_id)","                ","                //remove passport    ","            MongoDB.query({type: \"passport\"}).then(function(data){","                      ","            var temp = data","            var id","            id = temp[0]._id","            ","            MongoDB.remove_one(id)","  ","          })","                    ","            //remove contract        ","          MongoDB.query({type: \"contract\"}).then(function(data){","                      ","            var temp = data","            var id","            id = temp[0]._id","            ","            MongoDB.remove_one(id)","  ","          })","          ","          ","        ","        ","    $connection_status.disconnect()","        }","        ","","this.delete_everything = function (currency) {","        ","        // Update blob","        $scope.userBlob.unset('/basicincome_co');","        ","        ","        // remove from MongoDB","        MongoDB.collection($scope.userBlob.data.account_id)","                ","                //remove passport    ","            MongoDB.all({}).then(function(data){","            console.log(data)","            for(var i = 0; i<data.length;i++){","            ","            new MongoDB(data[i]).$remove().then(function (data) {","            console.log(data);","            });","            }","          })","","  new MongoDB().$delete_collection().then(function (data) {","            console.log(data);","            });","                    ","                    ","            //remove contract        ","          MongoDB.query({type: \"contract\"}).then(function(data){","                      ","            var temp = data","            var id","            id = temp[0]._id","            ","            MongoDB.remove_one(id)","  ","          })","          ","          ","        ","        ","    $connection_status.disconnect()","        }","        "]}]}],[{"group":"doc","deltas":[{"start":{"row":11,"column":0},"end":{"row":55,"column":0},"action":"insert","lines":["","    \t$scope.test = function(){}","","    ","    Project.get_database(function(data){","    ","    $scope.database = data","    console.log(data)})","    ","$scope.getpathways = function(address, callback){","  Project.collection(address)","  ","  Project.query({ type: \"safety_net_pathway\" }).then(function(data){","$scope.pathways = data","callback(data)","","  });","  ","}","","$scope.get_consumption_outside_network = function(address, callback){","  Project.collection(address)","  ","  Project.query({ type: \"consumption_outside_network\" }).then(function(data){","$scope.consumption_outside_network = data","callback(data)","","  });","  ","}","","","","$scope.get_tax_blob = function(address, callback){","  Project.collection(address)","  ","  Project.query({ type: \"tax_blob\" }).then(function(data){","$scope.tax_blob = data","callback(data)","","  });","  ","}","",""]}]}],[{"group":"doc","deltas":[{"start":{"row":15,"column":4},"end":{"row":15,"column":11},"action":"remove","lines":["Project"]},{"start":{"row":15,"column":4},"end":{"row":15,"column":5},"action":"insert","lines":[";"]}]}],[{"group":"doc","deltas":[{"start":{"row":15,"column":4},"end":{"row":15,"column":5},"action":"remove","lines":[";"]}]}],[{"group":"doc","deltas":[{"start":{"row":15,"column":4},"end":{"row":15,"column":5},"action":"insert","lines":["M"]}]}],[{"group":"doc","deltas":[{"start":{"row":15,"column":5},"end":{"row":15,"column":6},"action":"insert","lines":["o"]}]}],[{"group":"doc","deltas":[{"start":{"row":15,"column":6},"end":{"row":15,"column":7},"action":"insert","lines":["g"]}]}],[{"group":"doc","deltas":[{"start":{"row":15,"column":6},"end":{"row":15,"column":7},"action":"remove","lines":["g"]}]}],[{"group":"doc","deltas":[{"start":{"row":15,"column":4},"end":{"row":15,"column":6},"action":"remove","lines":["Mo"]},{"start":{"row":15,"column":4},"end":{"row":15,"column":11},"action":"insert","lines":["MongoDB"]}]}],[{"group":"doc","deltas":[{"start":{"row":8,"column":16},"end":{"row":8,"column":18},"action":"remove","lines":["rp"]},{"start":{"row":8,"column":16},"end":{"row":8,"column":17},"action":"insert","lines":["a"]}]}],[{"group":"doc","deltas":[{"start":{"row":8,"column":17},"end":{"row":8,"column":18},"action":"insert","lines":["p"]}]}],[{"group":"doc","deltas":[{"start":{"row":8,"column":18},"end":{"row":8,"column":19},"action":"insert","lines":["p"]}]}],[{"group":"doc","deltas":[{"start":{"row":5,"column":69},"end":{"row":5,"column":76},"action":"remove","lines":["Project"]},{"start":{"row":5,"column":69},"end":{"row":5,"column":76},"action":"insert","lines":["MongoDB"]},{"start":{"row":21,"column":2},"end":{"row":21,"column":9},"action":"remove","lines":["Project"]},{"start":{"row":21,"column":2},"end":{"row":21,"column":9},"action":"insert","lines":["MongoDB"]},{"start":{"row":23,"column":2},"end":{"row":23,"column":9},"action":"remove","lines":["Project"]},{"start":{"row":23,"column":2},"end":{"row":23,"column":9},"action":"insert","lines":["MongoDB"]},{"start":{"row":32,"column":2},"end":{"row":32,"column":9},"action":"remove","lines":["Project"]},{"start":{"row":32,"column":2},"end":{"row":32,"column":9},"action":"insert","lines":["MongoDB"]},{"start":{"row":34,"column":2},"end":{"row":34,"column":9},"action":"remove","lines":["Project"]},{"start":{"row":34,"column":2},"end":{"row":34,"column":9},"action":"insert","lines":["MongoDB"]},{"start":{"row":45,"column":2},"end":{"row":45,"column":9},"action":"remove","lines":["Project"]},{"start":{"row":45,"column":2},"end":{"row":45,"column":9},"action":"insert","lines":["MongoDB"]},{"start":{"row":47,"column":2},"end":{"row":47,"column":9},"action":"remove","lines":["Project"]},{"start":{"row":47,"column":2},"end":{"row":47,"column":9},"action":"insert","lines":["MongoDB"]}]}],[{"group":"doc","deltas":[{"start":{"row":5,"column":34},"end":{"row":5,"column":107},"action":"remove","lines":["I changed angular-mongolab.js, use MongoDB.collection instead, see below'"]}]}],[{"group":"doc","deltas":[{"start":{"row":5,"column":34},"end":{"row":5,"column":35},"action":"insert","lines":["'"]}]}],[{"group":"doc","deltas":[{"start":{"row":5,"column":34},"end":{"row":5,"column":35},"action":"remove","lines":["'"]}]}],[{"group":"doc","deltas":[{"start":{"row":5,"column":33},"end":{"row":5,"column":34},"action":"remove","lines":["'"]}]}],[{"group":"doc","deltas":[{"start":{"row":12,"column":0},"end":{"row":13,"column":0},"action":"remove","lines":["    \t$scope.test = function(){}",""]}]}],[{"group":"doc","deltas":[{"start":{"row":11,"column":0},"end":{"row":12,"column":0},"action":"remove","lines":["",""]}]}],[{"group":"doc","deltas":[{"start":{"row":10,"column":2},"end":{"row":11,"column":0},"action":"remove","lines":["",""]}]}],[{"group":"doc","deltas":[{"start":{"row":15,"column":23},"end":{"row":16,"column":0},"action":"insert","lines":["",""]},{"start":{"row":16,"column":0},"end":{"row":16,"column":4},"action":"insert","lines":["    "]}]}],[{"group":"doc","deltas":[{"start":{"row":16,"column":4},"end":{"row":17,"column":0},"action":"insert","lines":["",""]},{"start":{"row":17,"column":0},"end":{"row":17,"column":4},"action":"insert","lines":["    "]}]}],[{"group":"doc","deltas":[{"start":{"row":11,"column":4},"end":{"row":11,"column":8},"action":"insert","lines":["    "]}]}],[{"group":"doc","deltas":[{"start":{"row":11,"column":4},"end":{"row":11,"column":8},"action":"remove","lines":["    "]}]}],[{"group":"doc","deltas":[{"start":{"row":11,"column":4},"end":{"row":11,"column":5},"action":"insert","lines":["/"]}]}],[{"group":"doc","deltas":[{"start":{"row":11,"column":5},"end":{"row":11,"column":6},"action":"insert","lines":["/"]}]}],[{"group":"doc","deltas":[{"start":{"row":11,"column":5},"end":{"row":11,"column":6},"action":"remove","lines":["/"]}]}],[{"group":"doc","deltas":[{"start":{"row":11,"column":4},"end":{"row":11,"column":5},"action":"remove","lines":["/"]}]}],[{"group":"doc","deltas":[{"start":{"row":11,"column":4},"end":{"row":11,"column":5},"action":"insert","lines":["/"]}]}],[{"group":"doc","deltas":[{"start":{"row":11,"column":5},"end":{"row":11,"column":6},"action":"insert","lines":["/"]}]}],[{"group":"doc","deltas":[{"start":{"row":11,"column":6},"end":{"row":11,"column":7},"action":"insert","lines":[" "]}]}],[{"group":"doc","deltas":[{"start":{"row":11,"column":7},"end":{"row":11,"column":8},"action":"insert","lines":["o"]}]}],[{"group":"doc","deltas":[{"start":{"row":11,"column":8},"end":{"row":11,"column":9},"action":"insert","lines":["n"]}]}],[{"group":"doc","deltas":[{"start":{"row":11,"column":9},"end":{"row":11,"column":10},"action":"insert","lines":["e"]}]}],[{"group":"doc","deltas":[{"start":{"row":11,"column":9},"end":{"row":11,"column":10},"action":"remove","lines":["e"]}]}],[{"group":"doc","deltas":[{"start":{"row":11,"column":8},"end":{"row":11,"column":9},"action":"remove","lines":["n"]}]}],[{"group":"doc","deltas":[{"start":{"row":11,"column":7},"end":{"row":11,"column":8},"action":"remove","lines":["o"]}]}],[{"group":"doc","deltas":[{"start":{"row":11,"column":6},"end":{"row":11,"column":7},"action":"remove","lines":[" "]}]}],[{"group":"doc","deltas":[{"start":{"row":11,"column":5},"end":{"row":11,"column":6},"action":"remove","lines":["/"]}]}],[{"group":"doc","deltas":[{"start":{"row":11,"column":4},"end":{"row":11,"column":5},"action":"remove","lines":["/"]}]}],[{"group":"doc","deltas":[{"start":{"row":11,"column":0},"end":{"row":11,"column":4},"action":"remove","lines":["    "]}]}],[{"group":"doc","deltas":[{"start":{"row":10,"column":2},"end":{"row":11,"column":0},"action":"remove","lines":["",""]}]}],[{"group":"doc","deltas":[{"start":{"row":10,"column":0},"end":{"row":10,"column":2},"action":"remove","lines":["  "]},{"start":{"row":10,"column":0},"end":{"row":10,"column":1},"action":"insert","lines":["$"]}]}],[{"group":"doc","deltas":[{"start":{"row":10,"column":1},"end":{"row":10,"column":2},"action":"insert","lines":["s"]}]}],[{"group":"doc","deltas":[{"start":{"row":10,"column":2},"end":{"row":10,"column":3},"action":"insert","lines":["c"]}]}],[{"group":"doc","deltas":[{"start":{"row":10,"column":3},"end":{"row":10,"column":4},"action":"insert","lines":["o"]}]}],[{"group":"doc","deltas":[{"start":{"row":10,"column":4},"end":{"row":10,"column":5},"action":"insert","lines":["p"]}]}],[{"group":"doc","deltas":[{"start":{"row":10,"column":5},"end":{"row":10,"column":6},"action":"insert","lines":["e"]}]}],[{"group":"doc","deltas":[{"start":{"row":10,"column":6},"end":{"row":10,"column":7},"action":"insert","lines":["."]}]}],[{"group":"doc","deltas":[{"start":{"row":10,"column":7},"end":{"row":10,"column":8},"action":"insert","lines":["g"]}]}],[{"group":"doc","deltas":[{"start":{"row":10,"column":8},"end":{"row":10,"column":9},"action":"insert","lines":["e"]}]}],[{"group":"doc","deltas":[{"start":{"row":10,"column":9},"end":{"row":10,"column":10},"action":"insert","lines":["t"]}]}],[{"group":"doc","deltas":[{"start":{"row":10,"column":9},"end":{"row":10,"column":10},"action":"remove","lines":["t"]}]}],[{"group":"doc","deltas":[{"start":{"row":10,"column":8},"end":{"row":10,"column":9},"action":"remove","lines":["e"]}]}],[{"group":"doc","deltas":[{"start":{"row":10,"column":7},"end":{"row":10,"column":8},"action":"remove","lines":["g"]}]}],[{"group":"doc","deltas":[{"start":{"row":10,"column":6},"end":{"row":10,"column":7},"action":"remove","lines":["."]}]}],[{"group":"doc","deltas":[{"start":{"row":10,"column":5},"end":{"row":10,"column":6},"action":"remove","lines":["e"]}]}],[{"group":"doc","deltas":[{"start":{"row":10,"column":4},"end":{"row":10,"column":5},"action":"remove","lines":["p"]}]}],[{"group":"doc","deltas":[{"start":{"row":10,"column":3},"end":{"row":10,"column":4},"action":"remove","lines":["o"]}]}],[{"group":"doc","deltas":[{"start":{"row":10,"column":2},"end":{"row":10,"column":3},"action":"remove","lines":["c"]}]}],[{"group":"doc","deltas":[{"start":{"row":10,"column":1},"end":{"row":10,"column":2},"action":"remove","lines":["s"]}]}],[{"group":"doc","deltas":[{"start":{"row":10,"column":0},"end":{"row":10,"column":1},"action":"remove","lines":["$"]}]}],[{"group":"doc","deltas":[{"start":{"row":29,"column":0},"end":{"row":29,"column":6},"action":"remove","lines":["$scope"]},{"start":{"row":29,"column":0},"end":{"row":29,"column":1},"action":"insert","lines":["y"]}]}],[{"group":"doc","deltas":[{"start":{"row":29,"column":0},"end":{"row":29,"column":1},"action":"remove","lines":["y"]}]}],[{"group":"doc","deltas":[{"start":{"row":29,"column":0},"end":{"row":29,"column":1},"action":"insert","lines":["t"]}]}],[{"group":"doc","deltas":[{"start":{"row":29,"column":1},"end":{"row":29,"column":2},"action":"insert","lines":["h"]}]}],[{"group":"doc","deltas":[{"start":{"row":29,"column":2},"end":{"row":29,"column":3},"action":"insert","lines":["i"]}]}],[{"group":"doc","deltas":[{"start":{"row":29,"column":3},"end":{"row":29,"column":4},"action":"insert","lines":["s"]}]}],[{"group":"doc","deltas":[{"start":{"row":18,"column":0},"end":{"row":18,"column":6},"action":"remove","lines":["$scope"]},{"start":{"row":18,"column":0},"end":{"row":18,"column":1},"action":"insert","lines":["t"]}]}],[{"group":"doc","deltas":[{"start":{"row":18,"column":1},"end":{"row":18,"column":2},"action":"insert","lines":["h"]}]}],[{"group":"doc","deltas":[{"start":{"row":18,"column":2},"end":{"row":18,"column":3},"action":"insert","lines":["i"]}]}],[{"group":"doc","deltas":[{"start":{"row":18,"column":3},"end":{"row":18,"column":4},"action":"insert","lines":["s"]}]}],[{"group":"doc","deltas":[{"start":{"row":42,"column":0},"end":{"row":42,"column":6},"action":"remove","lines":["$scope"]},{"start":{"row":42,"column":0},"end":{"row":42,"column":1},"action":"insert","lines":["t"]}]}],[{"group":"doc","deltas":[{"start":{"row":42,"column":1},"end":{"row":42,"column":2},"action":"insert","lines":["h"]}]}],[{"group":"doc","deltas":[{"start":{"row":42,"column":2},"end":{"row":42,"column":3},"action":"insert","lines":["i"]}]}],[{"group":"doc","deltas":[{"start":{"row":42,"column":3},"end":{"row":42,"column":4},"action":"insert","lines":["s"]}]}]]},"ace":{"folds":[],"scrolltop":0,"scrollleft":0,"selection":{"start":{"row":0,"column":0},"end":{"row":1,"column":0},"isBackwards":true},"options":{"guessTabSize":true,"useWrapMode":false,"wrapToView":true},"firstLineState":{"row":1569,"mode":"ace/mode/javascript"}},"timestamp":1419776012282,"hash":"ab5ffc8b798a1e29c8af7c8cf8dc4dede01c517c"}